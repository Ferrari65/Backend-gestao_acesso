<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8"/>
    <title>Relatório de Acessos à Portaria</title>
    <style>
        /* Margens menores para caber mais linhas */
        @page { size: A4; margin: 10mm 10mm 12mm 10mm; }

        body {
          font-family: "Segoe UI", Arial, sans-serif;
          font-size: 11px;
          color: #222;
          background-color: #fff;
        }

        /* ==== Cabeçalho (mais compacto) ==== */
        .header {
          background-color: #53A67F;
          color: #fff;
          padding: 10px 12px;
          border-radius: 5px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
        }
        .titulo { font-size: 15px; font-weight: 700; letter-spacing: .2px; }
        .meta { font-size: 9.5px; opacity: .95; }

        /* ==== Filtros e sumário (compacto) ==== */
        .filtros, .sumario {
          margin: 6px 0 8px;
          font-size: 10px;
          padding: 6px 8px;
          border-left: 3px solid #53A67F;
          background-color: #f7faf8;
          border-radius: 4px;
          color: #333;
        }
        .filtros b, .sumario b { color: #35775B; }
        .sep { color: #999; margin: 0 6px; }

        /* ==== Tabela ==== */
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 6px;
          border-radius: 6px;
          overflow: hidden;
          table-layout: fixed;
        }
        thead { display: table-header-group; }
        tr { page-break-inside: avoid; }

        th {
          background-color: #53A67F;
          color: #fff;
          text-align: left;
          font-weight: 600;
          padding: 6px 8px;
          font-size: 10px;
          border-bottom: 1px solid #4b9471;
        }
        td {
          border-bottom: 1px solid #e0e0e0;
          padding: 5px 8px;
          font-size: 10px;
          vertical-align: top;
          line-height: 1.25;
        }
        tr:nth-child(even) td { background-color: #f9f9f9; }
        tr:hover td { background-color: #edf9f1; }

        .nowrap { white-space: nowrap; }
        .wrap { white-space: normal; overflow-wrap: anywhere; word-break: break-word; hyphens: auto; }

        .dt { display: block; }
        .hr { display: block; font-size: 9.5px; color: #555; }

        /* ==== Rodapé (menor) ==== */
        .rodape {
          font-size: 9px;
          color: #555;
          margin-top: 12px;
          text-align: center;
          border-top: 1px solid #ccc;
          padding-top: 6px;
        }

        .status-aberto { color: #27ae60; font-weight: 600; }
        .status-finalizado { color: #c0392b; font-weight: 600; }
    </style>
</head>
<body>

<!-- Cabeçalho -->
<div class="header">
    <div class="titulo">Relatório de Acessos à Portaria</div>
    <div class="meta">
        Gerado em:
        <span th:text="${#temporals.format(geradoEm, 'dd/MM/yyyy HH:mm')}">22/10/2025 09:00</span>
    </div>
</div>

<!-- Filtros -->
<div class="filtros">
    <b>Período:</b>
    <span th:text="${filtro.de()!=null ? #temporals.format(filtro.de(),'dd/MM/yyyy') : '—'}">—</span>
    a
    <span th:text="${filtro.ate()!=null ? #temporals.format(filtro.ate(),'dd/MM/yyyy') : '—'}">—</span>

    <span class="sep">|</span>

    <b>Tipo:</b>
    <span th:text="${filtro.tipoPessoa()!=null ? filtro.tipoPessoa() : 'Todos'}">Todos</span>

    <span class="sep">|</span>

    <b>Portaria:</b>
    <span th:text="${filtro.codPortaria()!=null ? filtro.codPortaria() : 'Todas'}">Todas</span>
</div>

<!-- Sumário -->
<div class="sumario">
    <b>Total:</b> <span th:text="${totaisGeral}">0</span>
    <span class="sep">|</span>
    <b>Abertos:</b> <span th:text="${totaisAbertos}">0</span>
    <span class="sep">|</span>
    <b>Finalizados:</b> <span th:text="${totaisFinalizados}">0</span>
</div>

<!-- Tabela -->
<table>
    <colgroup>
        <col style="width: 8%;" />
        <col style="width: 17%;" />
        <col style="width: 8%;" />
        <col style="width: 11%;" />
        <col style="width: 11%;" />
        <col style="width: 10%;" />
        <col style="width: 18%;" />
        <col style="width: 17%;" />
    </colgroup>

    <thead>
    <tr>
        <th>Tipo</th>
        <th>Condutor</th>
        <th>Portaria</th>
        <th>Entrada</th>
        <th>Saída</th>
        <th>Situação</th>
        <th>Ocupantes</th>
        <th>Observação</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="r : ${linhas}">
        <!-- TIPO ABREVIADO -->
        <td class="nowrap">
          <span th:switch="${#strings.toUpperCase(r.tipoPessoa())}">
            <span th:case="'COLABORADOR'">COLAB.</span>
            <span th:case="'VISITANTE'">VISIT.</span>
            <span th:case="'PRESTADOR DE SERVIÇO'">PREST.</span>
            <span th:case="'PRESTADOR DE SERVICO'">PREST.</span>
            <span th:case="'TERCEIRO'">TERC.</span>
            <span th:case="'MORADOR'">MOR.</span>
            <span th:case="*"
                  th:text="${r.tipoPessoa()!=null && r.tipoPessoa().length() > 7 ? r.tipoPessoa().substring(0,7) + '.' : r.tipoPessoa()}">
              TIPO
            </span>
          </span>
        </td>

        <td class="wrap" th:text="${r.condutor().nome()}">Maria de Souza Silva</td>
        <td class="nowrap" th:text="${r.codPortaria()}">1</td>

        <td class="nowrap">
            <span class="dt" th:text="${r.entrada()!=null ? #temporals.format(r.entrada(),'dd/MM/yyyy') : '—'}">—</span>
            <span class="hr" th:text="${r.entrada()!=null ? #temporals.format(r.entrada(),'HH:mm') : ''}"></span>
        </td>

        <td class="nowrap">
            <span class="dt" th:text="${r.saida()!=null ? #temporals.format(r.saida(),'dd/MM/yyyy') : '—'}">—</span>
            <span class="hr" th:text="${r.saida()!=null ? #temporals.format(r.saida(),'HH:mm') : ''}"></span>
        </td>

        <td class="nowrap">
            <span th:if="${r.saida()==null}" class="status-aberto">ABERTO</span>
            <span th:if="${r.saida()!=null}" class="status-finalizado">FINALIZADO</span>
        </td>

        <td class="wrap">
            <span th:if="${r.ocupantes() == null or #lists.isEmpty(r.ocupantes())}">—</span>
            <span th:if="${r.ocupantes() != null and !#lists.isEmpty(r.ocupantes())}">
                <span th:each="p, iter : ${r.ocupantes()}">
                    <span th:text="${p?.nome}">Nome</span><span th:if="${!iter.last}">, </span>
                </span>
            </span>
        </td>

        <td class="wrap" th:text="${r.observacao()!=null ? r.observacao() : '—'}">—</td>
    </tr>

    <tr th:if="${#lists.isEmpty(linhas)}">
        <td colspan="8" style="text-align:center;color:#666;">Sem registros para os filtros informados.</td>
    </tr>
    </tbody>
</table>

<div class="rodape">
    TrackPass • Gestão de Acesso • Relatório de Acessos à Portaria
</div>

</body>
</html>
